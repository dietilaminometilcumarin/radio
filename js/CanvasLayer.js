function CanvasLayer(e){this.isAdded_=!1,this.isAnimated_=!1,this.paneName_=CanvasLayer.DEFAULT_PANE_NAME_,this.updateHandler_=null,this.resizeHandler_=null,this.topLeft_=null,this.centerListener_=null,this.resizeListener_=null,this.needsResize_=!0,this.requestAnimationFrameId_=null;var t=document.createElement("canvas");function i(e,t){return function(){t.apply(e)}}t.style.position="absolute",t.style.top=0,t.style.left=0,t.style.pointerEvents="none",this.canvas=t,this.canvasCssWidth_=300,this.canvasCssHeight_=150,this.resolutionScale_=1,this.repositionFunction_=i(this,this.repositionCanvas_),this.resizeFunction_=i(this,this.resize_),this.requestUpdateFunction_=i(this,this.update_),e&&this.setOptions(e)}window.google&&(CanvasLayer.prototype=new google.maps.OverlayView),CanvasLayer.DEFAULT_PANE_NAME_="overlayLayer",CanvasLayer.CSS_TRANSFORM_=function(){for(var e=document.createElement("div"),t=["transform","WebkitTransform","MozTransform","OTransform","msTransform"],i=0;i<t.length;i++){var s=t[i];if(void 0!==e.style[s])return s}return t[0]}(),CanvasLayer.prototype.requestAnimFrame_=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){return window.setTimeout(e,1e3/60)},CanvasLayer.prototype.cancelAnimFrame_=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.oCancelAnimationFrame||window.msCancelAnimationFrame||function(e){},CanvasLayer.prototype.setOptions=function(e){void 0!==e.animate&&this.setAnimate(e.animate),void 0!==e.paneName&&this.setPaneName(e.paneName),void 0!==e.updateHandler&&this.setUpdateHandler(e.updateHandler),void 0!==e.resizeHandler&&this.setResizeHandler(e.resizeHandler),void 0!==e.resolutionScale&&this.setResolutionScale(e.resolutionScale),void 0!==e.map&&this.setMap(e.map)},CanvasLayer.prototype.setAnimate=function(e){this.isAnimated_=!!e,this.isAnimated_&&this.scheduleUpdate()},CanvasLayer.prototype.isAnimated=function(){return this.isAnimated_},CanvasLayer.prototype.setPaneName=function(e){this.paneName_=e,this.setPane_()},CanvasLayer.prototype.getPaneName=function(){return this.paneName_},CanvasLayer.prototype.setPane_=function(){if(this.isAdded_){var e=this.getPanes();if(!e[this.paneName_])throw new Error('"'+this.paneName_+'" is not a valid MapPane name.');e[this.paneName_].appendChild(this.canvas)}},CanvasLayer.prototype.setResizeHandler=function(e){this.resizeHandler_=e},CanvasLayer.prototype.setResolutionScale=function(e){"number"==typeof e&&(this.resolutionScale_=e,this.resize_())},CanvasLayer.prototype.setUpdateHandler=function(e){this.updateHandler_=e},CanvasLayer.prototype.onAdd=function(){this.isAdded_||(this.isAdded_=!0,this.setPane_(),this.resizeListener_=google.maps.event.addListener(this.getMap(),"resize",this.resizeFunction_),this.centerListener_=google.maps.event.addListener(this.getMap(),"center_changed",this.repositionFunction_),this.resize_(),this.repositionCanvas_())},CanvasLayer.prototype.onRemove=function(){this.isAdded_&&(this.isAdded_=!1,this.topLeft_=null,this.canvas.parentElement.removeChild(this.canvas),this.centerListener_&&(google.maps.event.removeListener(this.centerListener_),this.centerListener_=null),this.resizeListener_&&(google.maps.event.removeListener(this.resizeListener_),this.resizeListener_=null),this.requestAnimationFrameId_&&(this.cancelAnimFrame_.call(window,this.requestAnimationFrameId_),this.requestAnimationFrameId_=null))},CanvasLayer.prototype.resize_=function(){if(this.isAdded_){var e=this.getMap(),t=e.getDiv().getElementsByTagName("div")[0].offsetWidth,i=e.getDiv().getElementsByTagName("div")[0].offsetHeight,s=t*this.resolutionScale_,n=i*this.resolutionScale_,a=this.canvas.width,o=this.canvas.height;a===s&&o===n||(this.canvas.width=s,this.canvas.height=n,this.needsResize_=!0,this.scheduleUpdate()),this.canvasCssWidth_===t&&this.canvasCssHeight_===i||(this.canvasCssWidth_=t,this.canvasCssHeight_=i,this.canvas.style.width=t+"px",this.canvas.style.height=i+"px")}},CanvasLayer.prototype.draw=function(){this.repositionCanvas_()},CanvasLayer.prototype.repositionCanvas_=function(){var e=this.getMap(),t=e.getBounds().getNorthEast().lat(),i=e.getCenter(),s=Math.pow(2,e.getZoom()),n=i.lng()-180*this.canvasCssWidth_/(256*s);this.topLeft_=new google.maps.LatLng(t,n);var a=this.getProjection().fromLatLngToDivPixel(i),o=-Math.round(this.canvasCssWidth_/2-a.x),r=-Math.round(this.canvasCssHeight_/2-a.y);this.canvas.style[CanvasLayer.CSS_TRANSFORM_]="translate("+o+"px,"+r+"px)",this.scheduleUpdate()},CanvasLayer.prototype.update_=function(){this.requestAnimationFrameId_=null,this.isAdded_&&(this.isAnimated_&&this.scheduleUpdate(),this.needsResize_&&this.resizeHandler_&&(this.needsResize_=!1,this.resizeHandler_()),this.updateHandler_&&this.updateHandler_())},CanvasLayer.prototype.getTopLeft=function(){return this.topLeft_},CanvasLayer.prototype.scheduleUpdate=function(){this.isAdded_&&!this.requestAnimationFrameId_&&(this.requestAnimationFrameId_=this.requestAnimFrame_.call(window,this.requestUpdateFunction_))};